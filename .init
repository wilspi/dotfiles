#!/usr/bin/env bash

echo "Hello Batman ðŸ˜‰"
echo "INFO: Personalisation of your laptop has started ..."

# Get email
echo "Enter your email id:"
read email
# export email=$email
echo "INFO: Noted your email id as: $email"

# Get file path for current working directory
cwd="`(cd $(dirname \"$0\") && pwd -P )`"
if [ -z "$cwd" ] ; then
  echo "ERR: File path found empty"
  exit 1
fi

# Files to be generated
# All aliases are moved to .bash_aliases
# All other configs are moved to .bash_profile
bash_files=".bash_profile .bash_aliases"

# Backup any existing bash files
echo "INFO: Moving old dotfiles files to '~/dotfiles_old/bash'"
mkdir -p "~/dotfiles_old/bash"
for file in $bash_files; do
	[ -f ~/$file ] && mv ~/$file "~/dotfiles_old/bash"
done

# Generate bash files
mkdir "$cwd/bash"
touch "$cwd/bash/.bash_profile" "$cwd/bash/.bash_aliases"

# Run OS specific configs and scripts
if [ "$(uname -s)" = "Darwin" ]; then
  echo "INFO: 'MACOS' identified"
  $cwd/common/.setup $email
  $cwd/configs/.init "$cwd/configs" "MACOS"
  $cwd/macos/brew.sh
  cat $cwd/macos/.aliases >> $cwd/bash/.bash_aliases
  $cwd/common/aliases/.init >> $cwd/bash/.bash_aliases
elif [ "$(expr substr $(uname -s) 1 5)" = "Linux" ]; then
  echo "INFO: 'LINUX' identified"
  $cwd/common/.setup $email
  $cwd/configs/.init "$cwd/configs" "LINUX"
  $cwd/debian/apt.sh
  $cwd/common/aliases/.init >> $cwd/bash/.bash_aliases
else
  echo "ERR: Unidentified system found, probably a low grade one"
fi

# Symlink bash files in home directory
for file in $bash_files; do
	[ -f $cwd/bash/$file ] && ln -s "$cwd/bash/$file" ~/$file
done

echo "INFO: Personalisation completed"

# Reload .bash_profile .bash_aliases
# source ~/.bash_profile
source ~/.bash_aliases

echo "BYE: Have a good day"
